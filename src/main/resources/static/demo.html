<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>Todo List API è”è°ƒæµ‹è¯•é¡µé¢</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 20px; background-color: #f4f7f6; color: #333; }
        h1, h2 { color: #007bff; border-bottom: 2px solid #ccc; padding-bottom: 5px; }
        .container { max-width: 900px; margin: auto; background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        .section { margin-bottom: 30px; padding: 15px; border: 1px solid #ddd; border-radius: 6px; }
        label { display: block; margin-top: 10px; font-weight: bold; }
        input[type="text"], textarea { width: 100%; padding: 8px; margin-top: 5px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; }
        button { background-color: #007bff; color: white; padding: 10px 15px; border: none; border-radius: 4px; cursor: pointer; margin-top: 10px; font-size: 16px; }
        button:hover { background-color: #0056b3; }
        #results { margin-top: 20px; padding: 15px; background-color: #e9ecef; border-radius: 4px; white-space: pre-wrap; word-wrap: break-word; font-size: 14px; }
        .todo-item { border-bottom: 1px dashed #ccc; padding: 8px 0; display: flex; justify-content: space-between; align-items: center; }
        .todo-actions button { margin-left: 5px; padding: 5px 10px; font-size: 12px; }
        .completed { text-decoration: line-through; color: #6c757d; }
    </style>
</head>
<body>

<div class="container">
    <h1>ğŸ“ Todo List API è”è°ƒæµ‹è¯•</h1>
    <p>å½“å‰åç«¯åŸºç¡€URL: <code>http://localhost:8080/api/todos</code></p>

    <div class="section">
        <h2>åˆ›å»ºå¾…åŠäº‹é¡¹ (POST)</h2>
        <label for="title">æ ‡é¢˜ (Title):</label>
        <input type="text" id="title" value="å­¦ä¹  Spring Boot Controller">
        <label for="description">æè¿° (Description):</label>
        <textarea id="description">æ·±å…¥ç†è§£@RestControllerå’Œ@RequestMappingçš„ä½¿ç”¨ã€‚</textarea>
        <button onclick="createTodo()">åˆ›å»º (POST)</button>
        <button style="background-color: #dc3545;" onclick="createTodoEmptyTitle()">æµ‹è¯•éªŒè¯ (Titleä¸ºç©º)</button>
    </div>

    <div class="section">
        <h2>å¾…åŠäº‹é¡¹åˆ—è¡¨ (GET)</h2>
        <button onclick="getAllTodos()">åˆ·æ–°åˆ—è¡¨ (GET)</button>
        <div id="todo-list">
            <p>ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®åŠ è½½æ•°æ®...</p>
        </div>
    </div>

    <div class="section">
        <h2>API å“åº”ç»“æœ</h2>
        <pre id="results"></pre>
    </div>

</div>

<script>
    const API_BASE_URL = 'http://localhost:8080/api/todos';
    const resultsElement = document.getElementById('results');
    const todoListElement = document.getElementById('todo-list');

    /**
     * æ ¸å¿ƒè¾…åŠ©å‡½æ•°ï¼šæ‰§è¡Œ Fetch è¯·æ±‚
     */
    async function executeFetch(url, method, body = null) {
        try {
            const options = {
                method: method,
                headers: { 'Content-Type': 'application/json' },
            };
            if (body) {
                options.body = JSON.stringify(body);
            }

            const response = await fetch(url, options);
            const responseBody = await response.text();

            // æ ¼å¼åŒ–è¾“å‡ºç»“æœ
            resultsElement.innerHTML = `
                Status: ${response.status} ${response.statusText}\n
                URL: ${method} ${url}\n
                Response Body:\n${response.status !== 204 && responseBody ? JSON.stringify(JSON.parse(responseBody), null, 2) : responseBody}
            `;

            return { success: response.ok, data: responseBody ? JSON.parse(responseBody) : null, status: response.status };
        } catch (error) {
            resultsElement.innerHTML = `Error: ${error.message}`;
            return { success: false, data: null };
        }
    }

    /**
     * POST /api/todos
     */
    async function createTodo(title, description) {
        const body = {
            title: title || document.getElementById('title').value,
            description: description || document.getElementById('description').value,
            // completed å­—æ®µé»˜è®¤ä¸º false, åœ¨åç«¯å¤„ç†ï¼Œæ­¤å¤„æ— éœ€å‘é€
        };

        const result = await executeFetch(API_BASE_URL, 'POST', body);
        if (result.success) {
            getAllTodos(); // åˆ›å»ºæˆåŠŸååˆ·æ–°åˆ—è¡¨
        }
    }

    /**
     * POST æµ‹è¯•éªŒè¯ï¼šä¸å¸¦ Title
     */
    function createTodoEmptyTitle() {
        createTodo('', 'è¿™æ˜¯ä¸€ä¸ªæ²¡æœ‰æ ‡é¢˜çš„ä»»åŠ¡');
    }

    /**
     * GET /api/todos
     */
    async function getAllTodos() {
        const result = await executeFetch(API_BASE_URL, 'GET');

        if (result.success && Array.isArray(result.data)) {
            renderTodoList(result.data);
        } else {
            todoListElement.innerHTML = '<p style="color:red;">åŠ è½½åˆ—è¡¨å¤±è´¥ã€‚</p>';
        }
    }

    /**
     * PATCH /api/todos/{id}
     */
    async function toggleTodoStatus(id, currentStatus) {
        const result = await executeFetch(`${API_BASE_URL}/${id}`, 'PATCH', {
            completed: !currentStatus
        });
        if (result.success) {
            getAllTodos(); // æ›´æ–°æˆåŠŸååˆ·æ–°åˆ—è¡¨
        }
    }

    /**
     * DELETE /api/todos/{id}
     */
    async function deleteTodo(id) {
        if (!confirm(`ç¡®å®šè¦åˆ é™¤ ID: ${id} çš„å¾…åŠäº‹é¡¹å—ï¼Ÿ`)) {
            return;
        }
        const result = await executeFetch(`${API_BASE_URL}/${id}`, 'DELETE');
        if (result.status === 204) {
            resultsElement.innerHTML = `Status: 204 No Content\nURL: DELETE ${API_BASE_URL}/${id}\nMessage: åˆ é™¤æˆåŠŸ`;
            getAllTodos(); // åˆ é™¤æˆåŠŸååˆ·æ–°åˆ—è¡¨
        } else if (result.success) {
            getAllTodos(); // æˆåŠŸï¼ˆçŠ¶æ€ç 200ï¼‰ååˆ·æ–°åˆ—è¡¨
        }
    }

    /**
     * æ¸²æŸ“å¾…åŠäº‹é¡¹åˆ—è¡¨
     */
    function renderTodoList(todos) {
        if (todos.length === 0) {
            todoListElement.innerHTML = '<p>å½“å‰æ²¡æœ‰å¾…åŠäº‹é¡¹ã€‚</p>';
            return;
        }

        todoListElement.innerHTML = todos.map(todo => `
            <div class="todo-item ${todo.completed ? 'completed' : ''}">
                <div>
                    <strong>ID ${todo.id}: ${todo.title}</strong>
                    <br>
                    <small>${todo.description} (${todo.completed ? 'å·²å®Œæˆ' : 'æœªå®Œæˆ'})</small>
                </div>
                <div class="todo-actions">
                    <button onclick="toggleTodoStatus(${todo.id}, ${todo.completed})">
                        ${todo.completed ? 'æ ‡è®°ä¸ºæœªå®Œæˆ' : 'æ ‡è®°ä¸ºå·²å®Œæˆ'}
                    </button>
                    <button style="background-color: #dc3545;" onclick="deleteTodo(${todo.id})">
                        åˆ é™¤
                    </button>
                </div>
            </div>
        `).join('');
    }
</script>
</body>
</html>